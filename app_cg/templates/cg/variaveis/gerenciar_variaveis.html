{% extends 'cg/base.html' %}
{% block conteudo %}
{% load static %}

{% block styles %}
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap4.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/responsive/2.5.0/css/responsive.bootstrap4.min.css">
{% endblock %}
<div class="container-sm py-1">

    {% if messages %}
        <div class="mt-2">
            {% for message in messages %}
            <div class="alert 
                        {% if message.tags == 'success' %}alert-success{% endif %}
                        {% if message.tags == 'error' %}alert-danger{% endif %}
                        {% if message.tags == 'warning' %}alert-warning{% endif %}
                        {% if message.tags == 'info' %}alert-info{% endif %}
                        alert-dismissible fade show" role="alert">
                {{ message }}
                <button type="button" class="close" data-dismiss="alert" aria-label="Fechar"><span aria-hidden="true">&times;</span></button>
            </div>
            {% endfor %}
        </div>
    {% endif %}

    <div class="text-center mb-4">
        <h2 class="fw-bold">Variáveis</h2>
        <h6 class="fw-bold">{{ template.nome }}</h6>
        <hr class="mx-auto" style="width: 50px;">
    </div>

    <div class="text-end mb-4">
        <div class="mt-2">
            <!-- <button type="submit" class="btn btn-outline-secondary btn-sm w-100">
                <i class="bi bi-sliders"></i> Variáveis do template
            </button> -->
            <div class="col-12 text-right">
                {% if permiteAtualizavariaveis %}
                    <a href="{% url 'atualizar_variaveis' template.codtemplate %}" id="btn_atualizar_variaveis">
                        <button type="submit" class="btn btn-primary btn-sm custom-primary-link"><i class="fas fa-sync"></i> Atualizar Variáveis</button>
                    </a>
                {% else %}
                    <button type="submit" class="btn btn-primary btn-sm custom-primary-link" disabled><i class="fas fa-sync"></i> Atualizar Variáveis</button>
                {% endif %}
            </div>
        </div>
    </div>

    {% if vazio == 1 %}
        <div class="text-center mb-5 fst-italic fw-light">
            <p>Nenhuma variável cadastrada ainda.</p>
        </div>
    {% else %}
        <section class="content">
  <div class="card shadow-sm">
    <div class="card-header d-flex justify-content-between align-items-center">
      <h5 class="mb-0">
        <i class="fas fa-sync-alt text-info mr-2"></i> Atualização:
        <span class="text-muted">{{ dtatualiz|date:"d/m/Y H:i" }}</span>
      </h5>
    </div>

    <div class="card-body">
      <table id="tabela-variaveis" class="table table-bordered table-hover table-striped">
        <thead class="thead-light">
          <tr>
            <th><i class="fas fa-tag mr-1"></i> Nome</th>
            <th><i class="fas fa-align-left mr-1"></i> Descrição</th>
            <th><i class="fas fa-cube mr-1"></i> Tipo</th>
          </tr>
        </thead>
        <tbody>
          {% if jsonVariaveis %}
            {% for item in jsonVariaveis %}
              <tr>
                <td class="font-weight-bold">{{ item.nome }}</td>
                <td class="text-truncate" title="{{ item.descricao }}">
                  {{ item.descricao }}
                </td>
                <td><span class="badge badge-info">{{ item.tipo }}</span></td>
              </tr>
            {% endfor %}
          {% else %}
            <tr>
              <td colspan="3" class="text-center text-muted py-4">
                <i class="fas fa-info-circle mr-2"></i> Nenhuma variável encontrada.
              </td>
            </tr>
          {% endif %}
        </tbody>
      </table>
    </div>
  </div>
</section>
    {% endif %}
    
    <!-- <button onclick="history.back()" 
            type="button" 
            class="btn btn-secondary shadow-lg position-fixed">
        <i class="fas fa-arrow-left"></i> Voltar
    </button> -->
    <!-- <div class="position-fixed fixed-bottom left-0 right-0 p-3 bg-light shadow-lg">
        <button onclick="history.back()" type="button" class="btn btn-secondary"><i class="bi bi-caret-left"></i>Voltar</button>
    </div> -->
    
    <!-- Spinner de carregamento -->
    <!-- <div class="overlay position-fixed top-50 start-50 translate-middle">
      <div id="spinner" class="spinner-border text-dark" role="status" style="display: none;">
          <span class="visually-hidden"></span>
    </div> -->
</div>

<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap4.min.js"></script>
    <script src="https://cdn.datatables.net/responsive/2.5.0/js/dataTables.responsive.min.js"></script>
    <script src="https://cdn.datatables.net/responsive/2.5.0/js/responsive.bootstrap4.min.js"></script>

    <script>
        $(function () {
        $('#tabela-variaveis').DataTable({
            "paging": true,
            "lengthChange": true,
            "searching": true,
            "ordering": true,
            "info": true,
            "autoWidth": false,
            "responsive": true,
            "language": {
                "url": "https://cdn.datatables.net/plug-ins/1.13.6/i18n/pt-BR.json"
            }
        });
        });
    </script>
{% endblock %}